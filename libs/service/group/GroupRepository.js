"use strict";var r=this&&this.__awaiter||function(r,e,o,t){return new(o||(o=Promise))((function(i,n){function d(r){try{c(t.next(r))}catch(r){n(r)}}function u(r){try{c(t.throw(r))}catch(r){n(r)}}function c(r){var e;r.done?i(r.value):(e=r.value,e instanceof o?e:new o((function(r){r(e)}))).then(d,u)}c((t=t.apply(r,e||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.groupRepository=void 0;const e=require("../../common/DbFactory"),o=require("../../packages/definitions/types"),t=require("../../common"),i=require("../../common/RepoError");class n{insert(o){return r(this,void 0,void 0,(function*(){try{return e.commonDB.insertOne(n.TABLE_NAME,o)}catch(r){throw new i.RepoServerError(t.ErrorCode.SaveGroupError,"Fail to insert group!",r)}}))}hasTable(){return r(this,void 0,void 0,(function*(){try{return yield e.commonDB.hasTable(n.TABLE_NAME)}catch(r){throw new i.RepoServerError(t.ErrorCode.CheckGroupTableExistError,`fail to determine whether table "${n.TABLE_NAME}" exists!`,r)}}))}findByFilter(d={},u,c){return r(this,void 0,void 0,(function*(){const r={filter:d,orderBy:{keyList:["create_time"],orderList:[o.OrderType.DESC]}};u&&c&&(r.pageQuery={pageNum:u,pageSize:c});try{return e.commonDB.findByFilter(n.TABLE_NAME,r)}catch(r){throw new i.RepoServerError(t.ErrorCode.FindGroupError,"Fail to find group!",r)}}))}updateById(o){return r(this,void 0,void 0,(function*(){try{return e.commonDB.updateById(n.TABLE_NAME,o.getId(),o)}catch(r){throw new i.RepoServerError(t.ErrorCode.UpdateGroupError,"Fail to update group",r)}}))}findById(o){return r(this,void 0,void 0,(function*(){try{return e.commonDB.findById(n.TABLE_NAME,o)}catch(r){throw new i.RepoServerError(t.ErrorCode.FindGroupError,`Fail to find group whose id is ${o}!`,r)}}))}deleteById(o){return r(this,void 0,void 0,(function*(){try{return e.commonDB.deleteById(n.TABLE_NAME,o)}catch(r){throw new i.RepoServerError(t.ErrorCode.DeleteGroupError,`Fail to delete group whose id is "${o}"!`,r)}}))}findByUserId(o){return r(this,void 0,void 0,(function*(){try{return yield e.commonDB.findByFilter(n.TABLE_NAME,{filter:{owner_id:o}})}catch(r){throw new i.RepoServerError(t.ErrorCode.FindGroupError,"Fail to find group!",r)}}))}}n.TABLE_NAME="group",exports.groupRepository=new n;