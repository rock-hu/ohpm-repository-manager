"use strict";var t=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function a(t){try{c(n.next(t))}catch(t){r(t)}}function s(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))},e=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.createNewTableFromSqlFile=exports.initDataBase=void 0;const i=require("../../utils/FsUtil"),n=require("../../plugins/db/sqlDb/DbConnect"),o=require("./config"),r=require("../../common/DbAndStoreType"),a=require("../../common/DbFactory"),s=require("../log"),c=e(require("path")),l=require("../../common/Constants"),u=require("./constants");function f(e){return t(this,void 0,void 0,(function*(){try{const t=(yield i.FsUtil.readFile(e,"utf-8")).split(";;");for(const e of t)0!==e.length&&(yield n.dataSource.query(e))}catch(t){throw s.OhpmLazyLogger.error(`fail to initialize the MySQL data table using file "${e}": ${t}.`),new Error(`fail to initialize the MySQL data table: ${t}`)}}))}exports.initDataBase=function(){return t(this,void 0,void 0,(function*(){try{if(yield(0,a.initDB)(o.config.db),o.config.db.type===r.DbType.Mysql&&!(null===o.config||void 0===o.config?void 0:o.config.skip_db)){const t=c.default.join(l.Constants.WORK_DIR,u.PathConstants.SCHEMA_FILE_PATH);yield f(t),s.OhpmLazyLogger.info("deploy database table structure successfully.")}}catch(t){throw new Error(`fail to initialize dataBase: ${t}`)}}))},exports.createNewTableFromSqlFile=f;