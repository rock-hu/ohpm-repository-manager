import{B as E}from"./Button.59bb2c30.js";import{_ as T,z as B}from"./index.83aebd5f.js";import{t as j,j as k,ai as m,o as S,c as F,V as i,P as a,a as c,U as f,T as g,J as A,I as Z,e as J,B as K,_ as H,i as Q,u as X,S as Y}from"./@vue.405cd0f3.js";import{a as x}from"./vue-router.779da2c0.js";import{a as q}from"./element-plus.d9770c7f.js";import"./axios.a3888612.js";import"./vue-i18n.b3f06251.js";import"./@intlify.54dd1442.js";import"./vue.44d375da.js";import"./marked.710fa320.js";import"./xss.e4f2f0a8.js";import"./clipboard.ce371577.js";import"./cssfilter.393cb597.js";import"./dayjs.f9ab3a77.js";import"./node-forge.4054bff5.js";import"./@element-plus.1b716427.js";import"./vuex.10212040.js";import"./highlight.js.504c3f6b.js";/* empty css                            */import"./lodash-es.2c2c875c.js";import"./@vueuse.1b628eaa.js";import"./@popperjs.c75af06c.js";import"./@ctrl.86a38320.js";import"./async-validator.bf8f818c.js";import"./memoize-one.297ddbcb.js";import"./normalize-wheel-es.54f5de6c.js";import"./@floating-ui.57eef0fc.js";const ee=j({name:"systemDialog",props:{visible:Boolean,isShow:Boolean},setup(t,l){const v=()=>l.emit("onClose"),o=k(()=>t.visible);return{handleClose:v,handleSave:()=>{if(t.isShow)return!1;l.emit("save")},dialogVisible:o}}}),oe={class:"system-dialog"},te={class:"dialog-title"},ie={class:"content"},le={class:"f-14-Light"},ae={class:"btn"};function se(t,l,v,o,C,G){const b=m("el-button"),$=m("el-dialog");return S(),F("div",oe,[i($,{"close-on-click-modal":!1,modelValue:t.dialogVisible,"onUpdate:modelValue":l[2]||(l[2]=y=>t.dialogVisible=y),width:"640px","before-close":t.handleClose,"destroy-on-close":""},{header:a(()=>[c("div",te,f(t.$t("default.resetSystemPwd")),1)]),default:a(()=>[c("div",ie,[c("span",le,f(t.$t("default.resetTips")),1)]),c("div",ae,[i(b,{class:"btnCancel",onClick:l[0]||(l[0]=y=>t.handleClose())},{default:a(()=>[g(f(t.$t("button.cancel")),1)]),_:1}),i(b,{class:A(["btnColor",t.isShow?"btnNotAllow":null]),onClick:l[1]||(l[1]=y=>t.handleSave())},{default:a(()=>[g(f(t.$t("button.confirm")),1)]),_:1},8,["class"])])]),_:1},8,["modelValue","before-close"])])}const ne=T(ee,[["render",se],["__scopeId","data-v-aa839795"]]);const de=j({name:"validationDialog",props:{visible:Boolean,isConfirmDisabled:Boolean},setup(t,l){const v=()=>l.emit("onClose"),o=k(()=>t.visible);return{handleClose:v,handleSave:()=>{if(t.isConfirmDisabled)return!1;l.emit("save")},dialogVisible:o}}}),re={class:"system-dialog"},ue={class:"dialog-title"},me={class:"content"},pe={class:"btn"};function fe(t,l,v,o,C,G){const b=m("el-button"),$=m("el-dialog");return S(),F("div",re,[i($,{"close-on-click-modal":!1,modelValue:t.dialogVisible,"onUpdate:modelValue":l[2]||(l[2]=y=>t.dialogVisible=y),width:"1100px","before-close":t.handleClose,"destroy-on-close":""},{header:a(()=>[c("div",ue,f(t.$t("default.modifiedContent")),1)]),default:a(()=>[c("div",me,[Z(t.$slots,"default",{},void 0,!0)]),c("div",pe,[i(b,{class:"btnCancel",onClick:l[0]||(l[0]=y=>t.handleClose())},{default:a(()=>[g(f(t.$t("button.cancel")),1)]),_:1}),i(b,{class:A(["btnColor",t.isConfirmDisabled?"btnNotAllow":null]),onClick:l[1]||(l[1]=y=>t.handleSave())},{default:a(()=>[g(f(t.$t("button.confirm")),1)]),_:1},8,["class"])])]),_:3},8,["modelValue","before-close"])])}const ce=T(de,[["render",fe],["__scopeId","data-v-3d8e08ab"]]),be=()=>B.post("/api/system/resetKey").then(t=>t.data),ye=()=>B.get("/api/validation").then(t=>t==null?void 0:t.data),_e=t=>B.post("/api/validation",t,{headers:{"Content-Type":"application/json"}}).then(l=>l==null?void 0:l.data);const ge={class:"system"},ve={key:0,class:"contion"},he={class:"tab-pane-container"},Re={class:"tab-pane-container"},Ce={__name:"index",setup(t){const l=J(null),v=K("loginUser").loginUser;x();const o=H({btnDisabled:!0,form:{category:"",isRepositoryRequired:void 0,isNameFieldGroupRequired:void 0},system:{showDialog:!1,isConfirmDisabled:!1},validation:{showDialog:!1,isConfirmDisabled:!1},oldValidation:{category:"",isRepositoryRequired:void 0,isNameFieldGroupRequired:void 0},validationTableData:[]}),C=k(()=>{const{form:e,oldValidation:s}=o;return e.category!==s.category||e.isRepositoryRequired!==s.isRepositoryRequired||e.isNameFieldGroupRequired!==s.isNameFieldGroupRequired});Q(()=>{z()});const G=e=>{var r,u,h,V,w,R,N,_;const s=(V=(h=(u=(r=e==null?void 0:e.find(p=>p.attrName==="category"))==null?void 0:r.configs)==null?void 0:u.find(p=>p.ruleType==="WhiteList"))==null?void 0:h.ruleContent)!=null?V:"",d=!!((R=(w=e==null?void 0:e.find(p=>p.attrName==="repository"))==null?void 0:w.configs)!=null&&R.find(p=>p.ruleType==="NotNull")),n=!!((_=(N=e==null?void 0:e.find(p=>p.attrName==="name"))==null?void 0:N.configs)!=null&&_.find(p=>p.ruleType==="RegExp"));return{category:s,isRepositoryRequired:d,isNameFieldGroupRequired:n}},b=e=>[...new Set(e.split(";"))].join(";"),$=({category:e,isRepositoryRequired:s,isNameFieldGroupRequired:d})=>{const n=[],r={attrName:"category",configs:[{ruleType:"NotNull",description:"ohpm包层次类别非空校验",ruleContent:""},{ruleType:"WhiteList",description:"ohpm包层次类别白名单校验",ruleContent:e}]};e||(r.configs=[]),n.push(r);const u={attrName:"repository",configs:[{ruleType:"NotNull",description:"ohpm包代码托管仓库地址非空校验",ruleContent:""}]};s||(u.configs=[]),n.push(u);const h={attrName:"name",configs:[{ruleType:"RegExp",description:"name字段组织存在性校验",ruleContent:"name must contain group"}]};return d||(h.configs=[]),n.push(h),n},I={category:[{validator:(e,s,d)=>{/^([A-Za-z_]+;)*([A-Za-z_]+)?$/.test(s)?d():d(new Error(i18n("default.categoryValidateError")))},trigger:"blur"}]},W=()=>{o.system.showDialog=!0},D=e=>e?i18n("default.yes"):i18n("default.no"),L=async()=>{const e=l;o.btnDisabled||!C.value||!(e!=null&&e.value)||await e.value.validate(async s=>{if(s){const{form:d,oldValidation:n}=o;if(d.category!==n.category){const r=d.category===""?i18n("default.categoryBlankNote"):"";o.validationTableData.push({item:i18n("default.categoryWhitelist"),old:n.category,new:b(d.category),note:r})}d.isRepositoryRequired!==n.isRepositoryRequired&&o.validationTableData.push({item:i18n("default.isRepositoryRequired"),old:D(n.isRepositoryRequired),new:D(d.isRepositoryRequired),note:""}),d.isNameFieldGroupRequired!==n.isNameFieldGroupRequired&&o.validationTableData.push({item:i18n("system.isNameFieldGroupRequired"),old:D(n.isNameFieldGroupRequired),new:D(d.isNameFieldGroupRequired),note:""}),o.validation.showDialog=!0}})},P=()=>{o.system.isConfirmDisabled=!1,o.system.showDialog=!1},U=()=>{o.validation.isConfirmDisabled=!1,o.validation.showDialog=!1,o.validationTableData=[]},M=()=>{be().then(e=>{o.system.isConfirmDisabled=!0,e.code===200?q.success(i18n("default.resetSystemPwdSuccess")):q.error(e.message)}).finally(()=>P())},z=()=>{ye().then(e=>{if(e!=null&&e.data){const{category:s,isRepositoryRequired:d,isNameFieldGroupRequired:n}=G(e.data);o.form.category=s,o.form.isRepositoryRequired=d,o.form.isNameFieldGroupRequired=n,o.oldValidation.category=s,o.oldValidation.isRepositoryRequired=d,o.oldValidation.isNameFieldGroupRequired=n}}).finally(()=>{o.btnDisabled=!1})},O=async()=>{const e=l;e!=null&&e.value&&await e.value.validate(async s=>{if(s){const{category:d,isRepositoryRequired:n,isNameFieldGroupRequired:r}=o.form,u=await _e($({category:b(d),isRepositoryRequired:n,isNameFieldGroupRequired:r}));(u==null?void 0:u.code)===200?(o.btnDisabled=!0,U(),q.success(i18n("default.updateSuccess")),z()):q.error(u.message)}})};return(e,s)=>{const d=m("el-input"),n=m("el-form-item"),r=m("el-radio"),u=m("el-radio-group"),h=m("el-form"),V=m("el-tab-pane"),w=m("el-tabs"),R=m("el-table-column"),N=m("el-table");return S(),F("div",ge,[X(v).role===1?(S(),F("div",ve,[i(w,null,{default:a(()=>[i(V,{label:e.$t("default.validationRule")},{default:a(()=>[c("div",he,[i(h,{ref_key:"formRef",ref:l,model:o.form,rules:I},{default:a(()=>[i(n,{label:e.$t("default.categoryWhitelist"),prop:"category"},{default:a(()=>[i(d,{modelValue:o.form.category,"onUpdate:modelValue":s[0]||(s[0]=_=>o.form.category=_),autosize:{minRows:1},placeholder:e.$t("default.categoryPlaceholder"),maxlength:"1024","show-word-limit":"",spellcheck:"false",type:"textarea"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i(n,{label:e.$t("default.isRepositoryRequired")},{default:a(()=>[i(u,{modelValue:o.form.isRepositoryRequired,"onUpdate:modelValue":s[1]||(s[1]=_=>o.form.isRepositoryRequired=_)},{default:a(()=>[i(r,{value:!0},{default:a(()=>[g(f(e.$t("default.yes")),1)]),_:1}),i(r,{value:!1},{default:a(()=>[g(f(e.$t("default.no")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),i(n,{label:e.$t("system.isNameFieldGroupRequired")},{default:a(()=>[i(u,{modelValue:o.form.isNameFieldGroupRequired,"onUpdate:modelValue":s[2]||(s[2]=_=>o.form.isNameFieldGroupRequired=_)},{default:a(()=>[i(r,{value:!0},{default:a(()=>[g(f(e.$t("default.yes")),1)]),_:1}),i(r,{value:!1},{default:a(()=>[g(f(e.$t("default.no")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),i(n,null,{default:a(()=>[i(E,{disabled:o.btnDisabled||!C.value,isPrimary:!0,text:e.$t("button.submit"),class:"submit-btn",onClick:L},null,8,["disabled","text"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["label"]),i(V,{label:e.$t("default.systemPwd")},{default:a(()=>[c("div",Re,[i(E,{isPrimary:!0,text:e.$t("default.resetSystemPwd"),class:"submit-btn add-btn",onClick:W},null,8,["text"])])]),_:1},8,["label"])]),_:1})])):Y("",!0),i(ce,{isConfirmDisabled:o.validation.isConfirmDisabled,visible:o.validation.showDialog,onOnClose:U,onSave:O},{default:a(()=>[i(N,{data:o.validationTableData},{default:a(()=>[i(R,{label:e.$t("default.name"),prop:"item","show-overflow-tooltip":""},null,8,["label"]),i(R,{label:e.$t("default.beforeChange"),prop:"old","show-overflow-tooltip":""},null,8,["label"]),i(R,{label:e.$t("default.afterChange"),prop:"new","show-overflow-tooltip":""},null,8,["label"]),i(R,{label:e.$t("default.note"),prop:"note","show-overflow-tooltip":"",width:"auto"},null,8,["label"])]),_:1},8,["data"])]),_:1},8,["isConfirmDisabled","visible"]),i(ne,{isConfirmDisabled:o.system.isConfirmDisabled,visible:o.system.showDialog,onOnClose:P,onSave:M},null,8,["isConfirmDisabled","visible"])])}}},Qe=T(Ce,[["__scopeId","data-v-390aa4d3"]]);export{Qe as default};
