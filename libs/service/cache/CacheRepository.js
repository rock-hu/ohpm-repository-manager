"use strict";var e=this&&this.__awaiter||function(e,r,t,o){return new(t||(t=Promise))((function(i,n){function c(e){try{d(o.next(e))}catch(e){n(e)}}function a(e){try{d(o.throw(e))}catch(e){n(e)}}function d(e){var r;e.done?i(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(c,a)}d((o=o.apply(e,r||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.cacheRepository=void 0;const r=require("../../common/DbFactory"),t=require("../../common"),o=require("../../common/RepoError"),i=require("../../packages/definitions/types");exports.cacheRepository=new class{constructor(){this.TABLE_NAME="cacheData"}insert(i){return e(this,void 0,void 0,(function*(){try{return r.commonDB.insertOne(this.TABLE_NAME,i,!0)}catch(e){throw new o.RepoServerError(t.ErrorCode.SaveCacheError,"Fail to add cache!",e)}}))}updateState(i,n,c,a){return e(this,void 0,void 0,(function*(){try{const e="object"==typeof n;return a=a||(new Date).getTime(),r.commonDB.updateById(this.TABLE_NAME,i,{id:i,value:e?JSON.stringify(n):n,options:JSON.stringify(c),isObject:e,createTime:a},!0)}catch(e){throw new o.RepoServerError(t.ErrorCode.UpdateCacheError,"Fail to update cache!",e)}}))}findCacheDataByKey(i){return e(this,void 0,void 0,(function*(){try{return r.commonDB.findById(this.TABLE_NAME,i)}catch(e){throw new o.RepoServerError(t.ErrorCode.FindCacheError,"Fail to find cache!",e)}}))}deleteByKey(i){return e(this,void 0,void 0,(function*(){try{return r.commonDB.deleteById(this.TABLE_NAME,i)}catch(e){throw new o.RepoServerError(t.ErrorCode.DeleteCacheError,"Fail to delete cache!",e)}}))}findByFilter(n,c,a){return e(this,void 0,void 0,(function*(){try{return r.commonDB.findByFilter(this.TABLE_NAME,{filter:a||null,orderBy:{keyList:["createTime"],orderList:[i.OrderType.DESC]},pageQuery:{pageNum:n,pageSize:c}})}catch(e){throw new o.RepoServerError(t.ErrorCode.FindCacheListError,"Fail to get cacheList!",e)}}))}};