"use strict";var e=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,u)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.EntityMap=exports.initConnect=exports.dataSource=void 0,require("reflect-metadata");const t=require("typeorm"),i=require("../../../entity/Group"),r=require("../../../entity/LoginFailure"),n=require("../../../entity/DeployedInstance"),a=require("../../../entity/AdminAuditLog"),o=require("../../../entity/User"),u=require("../../../entity/Uplink"),s=require("../../../entity/UplinkProxy"),c=require("../../../entity/Repo"),y=require("../../../entity/GroupMember"),p=require("../../../entity/PackageManifest"),l=require("../../../entity/PackageMetaData"),d=require("../../../entity/Dependency"),g=require("../../../entity/DownloadFailure"),q=require("../../../entity/PublicKey"),k=require("../../../utils/CryptoUtil"),f=require("../../../entity/LoginStatus"),m=require("../../../entity/CacheData"),D=require("../../../entity/ValidationConfigEntity"),h=require("../../../packages/log"),v=require("../../../entity/AccessToken"),x=require("../../../entity/DistTags"),w=require("../../../entity/DownloadPackage");function _(){return e(this,void 0,void 0,(function*(){try{yield exports.dataSource.query("SELECT 1;")}catch(e){(0,h.consoleError)(`mysql keepAlive err: ${e}`)}}))}exports.initConnect=function(i){return e(this,void 0,void 0,(function*(){const e=k.CryptoUtil.getVersion(),r=yield k.CryptoUtil.decrypt(i.password,e);exports.dataSource=new t.DataSource({type:"mysql",host:i.host,port:i.port,username:i.username,password:r,database:i.database,synchronize:!1,logging:!1,entities:Object.values(exports.EntityMap),migrations:[],subscribers:[]}),setInterval(_,6e4)}))},exports.EntityMap={adminAuditLog:a.AdminAuditLog,cacheData:m.CacheData,dependency:d.Dependency,deployedInstance:n.DeployedInstance,downloadFailure:g.DownloadFailure,group:i.Group,group_member:y.GroupMember,loginFailure:r.LoginFailure,loginStatus:f.LoginStatus,package_manifest:p.PackageManifest,package_metadata:l.PackageMetaData,public_key:q.PublicKey,repo:c.Repo,uplink:u.Uplink,uplink_proxy:s.UplinkProxy,user:o.User,validation_config:D.ValidationConfigEntity,access_token:v.AccessToken,dist_tags:x.DistTags,download_package:w.DownloadPackage};