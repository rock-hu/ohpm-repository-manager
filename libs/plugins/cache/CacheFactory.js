"use strict";var e=this&&this.__awaiter||function(e,t,r,c){return new(r||(r=Promise))((function(a,n){function s(e){try{o(c.next(e))}catch(e){n(e)}}function i(e){try{o(c.throw(e))}catch(e){n(e)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,i)}o((c=c.apply(e,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultCacheFunOpts=exports.CacheFactory=void 0;const t=require("./MemoryCache"),r=require("./RedisCache"),c=require("./DbCache");class a{static createCache(e={mode:"memory"}){switch(e.mode){case"memory":return t.memoryCache;case"db":return c.dbCache;case"redis":return new r.RedisCache(e.params);default:throw new Error("unsupported cache mode")}}static cacheAsyncFun(t,r=a.createCache(),c={},n=!0){const s=Object.assign(Object.assign({},exports.defaultCacheFunOpts),c);return function(...c){return e(this,void 0,void 0,(function*(){const e=s.calculateKey(c);if(yield r.exists(e))return r.get(e);const a=yield t.apply(this,c);return void 0!==a&&(yield r.set(e,a,s)),void 0===a&&n&&(yield r.set(e,a,s)),a}))}}}exports.CacheFactory=a,exports.defaultCacheFunOpts={ttl:60,isCachedForever:!1,calculateKey:(...e)=>JSON.stringify(e)};