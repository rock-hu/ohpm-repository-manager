"use strict";var e=this&&this.__awaiter||function(e,i,t,o){return new(t||(t=Promise))((function(r,n){function d(e){try{u(o.next(e))}catch(e){n(e)}}function s(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){var i;e.done?r(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(d,s)}u((o=o.apply(e,i||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.adminAuditLogService=exports.AdminAuditLogService=void 0;const i=require("../../entity/AdminAuditLog"),t=require("./AdminAuditLogRepository"),o=require("../user/UserRepository"),r=require("../../packages/definitions/types"),n=require("../../common/OperateType"),d=require("../user/UserService"),s=require("../../common/RepoError"),u=require("../../common"),a=require("../../common/CommonValidator");class c{addSuccessLog(i,t,o){return e(this,void 0,void 0,(function*(){yield this.addAdminAuditLog(i,t,n.OperateResult.success,o)}))}addFailureLog(i,t,o){return e(this,void 0,void 0,(function*(){yield this.addAdminAuditLog(i,t,n.OperateResult.failure,o)}))}addAdminAuditLog(r,n,d,s){return e(this,void 0,void 0,(function*(){const e=yield o.userRepository.findUserById(r);if(e){const o=new i.AdminAuditLog({adminId:e.id,adminName:e.name,operationType:n,operationDescription:d,operationDetail:s,role:e.role});yield t.adminAuditLogRepository.insert(o)}}))}getAdminAuditLogListByFilter(i,o){return e(this,void 0,void 0,(function*(){a.CommonValidator.checkUUID(i);if(!((yield d.userService.getUserByUserId(i)).role===r.RoleType.Admin))throw new s.RepoClientError(u.ErrorCode.UserPermissionError,"current user is not the system administrator and does not have the operation permission.");const e=o.getFilterAuditLog();return t.adminAuditLogRepository.getAuditLogListByFilter(o.getPageNum(),o.getPageSize(),e)}))}deleteExpiredOperationLogs(i,o){return e(this,void 0,void 0,(function*(){yield t.adminAuditLogRepository.deleteByRangeTime(i,o)}))}}exports.AdminAuditLogService=c,exports.adminAuditLogService=new c;