"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var o={};if(null!=r)for(var n in r)"default"!==n&&Object.prototype.hasOwnProperty.call(r,n)&&e(o,r,n);return t(o,r),o},o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(n,i){function s(e){try{u(o.next(e))}catch(e){i(e)}}function c(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,c)}u((o=o.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.encryptPwdCmd=void 0;const i=require("../packages/crypto"),s=n(require("path")),c=require("../packages/crypto/base"),u=require("../utils/FsUtil"),a=r(require("readline")),l=require("../packages/log"),d=n(require("log4js"));exports.encryptPwdCmd=function(e){return o(this,void 0,void 0,(function*(){try{if(!e.crypto_path)throw Error("crypto_path must be specified");const t=s.default.resolve(process.cwd(),e.crypto_path),r=(yield u.FsUtil.exists(t))?yield u.FsUtil.readdir(t):[];let n=null;0!==r.length&&(n=yield(0,i.loadCustomKeys)(t)),null===n&&(yield(0,i.createKey)(t),n=yield(0,i.loadCustomKeys)(t)),yield function(e){return o(this,void 0,void 0,(function*(){const t=process.stdin,r=process.stdout,o=a.createInterface({input:t,output:r,terminal:!0});o.on("close",(()=>process.exit(0))),yield o.question("Please enter the password to be encrypted:\n",(t=>{try{if(t){const r=c.AesCryptUtil.encryptAesGcm(t,e.getEncWorkKey(),e.getRootKey());(0,l.consoleInfo)(`encrypted result:\n${r}.`)}}catch(e){throw new Error(`fail to encrypt password: ${e}`)}finally{e.destroy(),o.close()}}))}))}(n)}catch(e){(0,l.consoleError)(`server fail to encrypt password: ${e}.`),d.default.shutdown((()=>process.exit(1)))}}))};