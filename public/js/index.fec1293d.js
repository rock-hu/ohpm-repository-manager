import{P as L}from"./centerPagination.65484f4d.js";import{_ as P,d as M}from"./index.83aebd5f.js";import{i as T,e as q,j as x,k as F}from"./organization.f666534f.js";import{a as Y}from"./vue-router.779da2c0.js";import{C as j}from"./ConfirmDialog.f3308ea3.js";import{B as E}from"./Button.59bb2c30.js";import{a as _}from"./element-plus.d9770c7f.js";import{e as J,_ as O,j as Q,f as B,ai as s,o as h,c as N,V as a,P as n,a as D,U as p,T as U,h as W,B as H,i as K,aq as X,u as Z,O as V,S as k,Q as ee,J as oe}from"./@vue.405cd0f3.js";import{u as te}from"./vuex.10212040.js";import"./axios.a3888612.js";import"./vue-i18n.b3f06251.js";import"./@intlify.54dd1442.js";import"./vue.44d375da.js";import"./marked.710fa320.js";import"./xss.e4f2f0a8.js";import"./clipboard.ce371577.js";import"./cssfilter.393cb597.js";import"./dayjs.f9ab3a77.js";import"./node-forge.4054bff5.js";import"./@element-plus.1b716427.js";import"./highlight.js.504c3f6b.js";/* empty css                            */import"./lodash-es.2c2c875c.js";import"./@vueuse.1b628eaa.js";import"./@popperjs.c75af06c.js";import"./@ctrl.86a38320.js";import"./async-validator.bf8f818c.js";import"./memoize-one.297ddbcb.js";import"./normalize-wheel-es.54f5de6c.js";import"./@floating-ui.57eef0fc.js";import"./FooterButtons.71958792.js";const ae={class:"member-add-dialog"},re={class:"dialog-title"},ne={__name:"AddGroupAdminDialog",props:{visible:Boolean,groupId:String,groupName:String},emits:["onClose","afterAddUser"],setup(G,{emit:b}){const w=G,r=b,g=J(null),e=O({user:{account:"",role:"owner"},showDialog:!1}),v=Q(()=>({account:[{required:!0,message:i18n("login.inputUserName"),trigger:"blur"}]}));B(()=>w.visible,t=>{e.showDialog=t});const z=()=>{e.user.account=""},f=()=>{z(),r("onClose")},C=t=>{t.validate(i=>{i&&T(w.groupId,{userName:e.user.account}).then(d=>{d.code===200&&_.success("添加成功")}).finally(()=>{r("afterAddUser"),f()})})};return(t,i)=>{const d=s("el-input"),A=s("el-form-item"),S=s("el-form"),y=s("el-button"),I=s("el-dialog");return h(),N("div",ae,[a(I,{modelValue:e.showDialog,"onUpdate:modelValue":i[2]||(i[2]=u=>e.showDialog=u),"before-close":f,"close-on-click-modal":!1,"destroy-on-close":"",width:"460px"},{header:n(()=>[D("div",re,p(t.$t("organization.addGroupAdminTitle")),1)]),default:n(()=>[a(S,{ref_key:"formRef",ref:g,model:e.user,rules:v.value,"label-position":"left","label-width":"auto"},{default:n(()=>[a(A,{label:t.$t("default.user"),class:"dialog-user",prop:"account"},{default:n(()=>[a(d,{modelValue:e.user.account,"onUpdate:modelValue":i[0]||(i[0]=u=>e.user.account=u),placeholder:t.$t("login.inputUserName"),style:{width:"90%"},class:"account-input"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"]),a(A,{class:"dialog-footer"},{default:n(()=>[a(y,{class:"btnCancel",onClick:f},{default:n(()=>[U(p(t.$t("button.cancel")),1)]),_:1}),a(y,{class:"btnColor",onClick:i[1]||(i[1]=u=>C(g.value))},{default:n(()=>[U(p(t.$t("button.submit")),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},ie=P(ne,[["__scopeId","data-v-83720106"]]);const le={class:"group-admin-setting"},se={class:"member-list-item"},de={key:0},ue=["onClick"],me=1,ce={__name:"index",setup(G){const b=W().appContext.config.globalProperties,w=H("loginUser").loginUser,r=Y(),g=te(),e=O({headStyle:{background:"#F5F5F5",color:"#000000"},headRowStyle:{height:"40px"},currentPage:1,pageSize:10,totalSize:0,memberLoading:!0,adminsList:[],groupAdmin:{},dialogVisible:!1,showGroupAdminAddDialog:!1,orgName:"",orgId:""});K(async()=>{await v()}),B(()=>r.currentRoute.value,async()=>{r.currentRoute.value.name==="organizationAdminSetting"&&await v()});const v=async()=>{if(!(e.orgId===r.currentRoute.value.query.orgId&&e.orgName)){if(e.orgId=r.currentRoute.value.query.orgId,!r.currentRoute.value.query.orgId){_.error(b.$t("organization.orgIdWithout")),await r.push({name:"organizations"});return}try{await g.dispatch("updateOrganizationAdminSettingOrgBread","");const o=await q(e.orgId);e.orgName=o.data.name,await g.dispatch("updateOrganizationAdminSettingOrgBread",e.orgName);const l={id:e.orgId,name:e.orgName,description:o.data.description,owner:o.data.owner};sessionStorage.setItem("organizeDetail",JSON.stringify(l)),await t()}catch(o){await r.push({name:"organizations"})}}},z=o=>M(o,"YYYY-MM-DD hh:mm:ss"),f=o=>{e.currentPage=o,t(o)},C=({columnIndex:o})=>o===2?"cell-pl-0":"",t=async(o=0)=>{e.memberLoading=!0;try{const l=await x(e.orgId,{currentPage:o||me,pageSize:e.pageSize});if(l.code===200){const{total:m,data:$}=l.data;e.adminsList=$,e.totalSize=m}else _.error(l.message)}catch(l){await r.push({name:"organizations"})}finally{e.memberLoading=!1}},i=o=>{if(e.totalSize===1){_.warning(b.$t("organization.cannotDelLastGroupAdmin"));return}e.groupAdmin=o,e.dialogVisible=!0},d=()=>{e.dialogVisible=!1},A=()=>{d(),S()},S=()=>{F({groupId:e.orgId,groupAdminId:e.groupAdmin.id}).then(o=>{o.code===200&&_.success(i18n("notification.deleteSuccess"))}).finally(()=>{e.currentPage=1,t()})},y=()=>{e.showGroupAdminAddDialog=!0},I=()=>{e.showGroupAdminAddDialog=!1},u=()=>{e.currentPage=1,t(e.currentPage)};return(o,l)=>{const m=s("el-table-column"),$=s("el-table"),R=X("loading");return h(),N("div",le,[D("div",null,[Z(w).role?(h(),V(E,{key:0,isPrimary:!0,text:o.$t("organization.addGroupAdmin"),class:"add-new-member-btn",onClick:l[0]||(l[0]=c=>y())},null,8,["text"])):k("",!0)]),D("div",se,[ee((h(),V($,{"cell-class-name":C,data:e.adminsList,"empty-text":o.$t("tree.noData"),"header-cell-style":e.headStyle,"header-row-style":e.headRowStyle},{default:n(()=>[a(m,{label:o.$t("default.username"),prop:"userName","show-overflow-tooltip":""},null,8,["label"]),a(m,{label:o.$t("default.role"),prop:"role","show-overflow-tooltip":""},{default:n(c=>[c.row.role===1?(h(),N("span",de,p(o.$t("organization.owner")),1)):k("",!0)]),_:1},8,["label"]),a(m,{label:o.$t("default.addTime"),prop:"createTime","show-overflow-tooltip":""},{default:n(c=>[U(p(z(c.row.createTime)),1)]),_:1},8,["label"]),a(m,{label:o.$t("security.operate"),"show-overflow-tooltip":"",width:"200px"},{default:n(c=>[D("span",{class:oe(["del",e.totalSize===1?"delNot":null]),onClick:pe=>i(c.row)},p(o.$t("notification.delete")),11,ue)]),_:1},8,["label"])]),_:1},8,["data","empty-text","header-cell-style","header-row-style"])),[[R,e.memberLoading]]),a(L,{"current-page":e.currentPage,handleCurrentChange:f,"page-size":e.pageSize,total:e.totalSize},null,8,["current-page","page-size","total"])]),a(j,{title:o.$t("notification.confirmTitle",{name:e.groupAdmin.userName}),visible:e.dialogVisible,onOnClose:d,onOnConfirm:A},null,8,["title","visible"]),a(ie,{groupId:e.orgId,groupName:e.orgName,visible:e.showGroupAdminAddDialog,onAfterAddUser:u,onOnClose:I},null,8,["groupId","groupName","visible"])])}}},je=P(ce,[["__scopeId","data-v-c6a4241c"]]);export{je as default};
