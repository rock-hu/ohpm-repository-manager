"use strict";var e=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function c(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((i=i.apply(e,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.unPublishRepository=void 0;const t=require("../../../common/DbFactory"),n=require("../../../entity/Dependency"),i=require("../../../entity/PackageManifest"),o=require("../../../packages/definitions/types"),r=require("../../../utils/CommonConstants");exports.unPublishRepository=new class{existDependents(i,o,r){return e(this,void 0,void 0,(function*(){const e={repoName:i,depPackageName:o};r&&(e.depPackageVersion=r);const{total:s}=yield t.commonDB.findByFilter(n.OHPM_DEPENDENCY_DB_NAME,{filter:e});return s>0}))}getDependents(i,o,r){return e(this,void 0,void 0,(function*(){const e={repoName:i,depPackageName:o};return r&&(e.depPackageVersion={in:r}),t.commonDB.findByFilter(n.OHPM_DEPENDENCY_DB_NAME,{filter:e})}))}deleteDependencies(i,o,r){return e(this,void 0,void 0,(function*(){const e={repoName:i,name:o};r&&(e.version={in:r});const{total:s,recordList:c}=yield t.commonDB.findByFilter(n.OHPM_DEPENDENCY_DB_NAME,{filter:e});if(s>0&&c)for(const e of c)yield t.commonDB.deleteById(n.OHPM_DEPENDENCY_DB_NAME,e.id)}))}selectPublishedCategorys(n,s,c){return e(this,void 0,void 0,(function*(){const e={repoName:n,name:s,status:r.PackageStatus.Published};return c&&(e.version={in:c}),t.commonDB.findByFilter(i.OHPM_PACKAGE_MANIFEST_DB_NAME,{filter:e,orderBy:{keyList:["publishTime"],orderList:[o.OrderType.DESC]}})}))}};