"use strict";var r=this&&this.__awaiter||function(r,e,o,t){return new(o||(o=Promise))((function(n,i){function s(r){try{E(t.next(r))}catch(r){i(r)}}function a(r){try{E(t.throw(r))}catch(r){i(r)}}function E(r){var e;r.done?n(r.value):(e=r.value,e instanceof o?e:new o((function(r){r(e)}))).then(s,a)}E((t=t.apply(r,e||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.DistTagsRepository=void 0;const e=require("../../../common/DbFactory"),o=require("../../../common/RepoError"),t=require("../../../common"),n=require("../../../common/ErrorCode");class i{constructor(){this.TABLE_NAME="dist_tags"}static getInstance(){return this.Instance||(this.Instance=new i),this.Instance}insert(i){return r(this,void 0,void 0,(function*(){try{return e.commonDB.insertOne(this.TABLE_NAME,i,!0)}catch(r){throw new o.RepoServerError(t.ErrorCode.SaveDistTagsError,n.MESSAGE_CN[t.ErrorCode.SaveDistTagsError],r)}}))}deleteById(i){return r(this,void 0,void 0,(function*(){try{return e.commonDB.deleteById(this.TABLE_NAME,i,!0)}catch(r){throw new o.RepoServerError(t.ErrorCode.DeleteDistTagsError,n.MESSAGE_CN[t.ErrorCode.DeleteDistTagsError],r)}}))}deleteByQueryFilter(i){return r(this,void 0,void 0,(function*(){try{return e.commonDB.deleteByQueryFilter(this.TABLE_NAME,i,!0)}catch(r){throw new o.RepoServerError(t.ErrorCode.DeleteDistTagsError,n.MESSAGE_CN[t.ErrorCode.DeleteDistTagsError],r)}}))}findByRepoNameAndPkgName(i,s){return r(this,void 0,void 0,(function*(){try{return e.commonDB.findByFilter(this.TABLE_NAME,{filter:{repoName:i,packageName:s}})}catch(r){throw new o.RepoServerError(t.ErrorCode.FindDistTagsError,n.MESSAGE_CN[t.ErrorCode.FindDistTagsError],r)}}))}findByRepoNameAndPkgNameAndTag(i,s,a){return r(this,void 0,void 0,(function*(){try{return e.commonDB.findByFilter(this.TABLE_NAME,{filter:{repoName:i,packageName:s,tag:a}})}catch(r){throw new o.RepoServerError(t.ErrorCode.FindDistTagsError,n.MESSAGE_CN[t.ErrorCode.FindDistTagsError],r)}}))}findByRepoNameAndPkgNameAndVersions(i,s,a){return r(this,void 0,void 0,(function*(){try{return e.commonDB.findByFilter(this.TABLE_NAME,{filter:{repoName:i,packageName:s,version:{in:a}}})}catch(r){throw new o.RepoServerError(t.ErrorCode.FindDistTagsError,n.MESSAGE_CN[t.ErrorCode.FindDistTagsError],r)}}))}updateById(i,s){return r(this,void 0,void 0,(function*(){try{return e.commonDB.updateById(this.TABLE_NAME,i,s,!0)}catch(r){throw new o.RepoServerError(t.ErrorCode.UpdateDistTagsError,n.MESSAGE_CN[t.ErrorCode.UpdateDistTagsError],r)}}))}}exports.DistTagsRepository=i;