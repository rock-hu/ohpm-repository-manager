"use strict";var t=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))((function(n,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function c(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(s,c)}u((r=r.apply(t,e||[])).next())}))},e=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.stopExecute=exports.stopCmd=void 0;const o=require("../utils/FsUtil"),r=require("../packages/log"),n=require("child_process"),i=require("./install"),s=require("../packages/config/constants"),c=e(require("log4js")),u=/^[0-9]+$/;function l(){return t(this,void 0,void 0,(function*(){const t=yield(0,i.readFileFromEnv)(s.PathConstants.RUNTIME_PID_PATH);if(!(yield o.FsUtil.exists(t)))throw new Error("no ohpm-repo instance found, stop end");const e=yield o.FsUtil.readFile(t);if(!u.test(e.toString()))throw new Error("illegal operation, stop end");const r="win32"===process.platform?"CHCP 65001 && taskkill /F /PID ":"kill -9 ";try{(0,n.execSync)(r+e.toString(),{encoding:"utf-8"}),yield o.FsUtil.rm(t)}catch(t){throw new Error(`No ohpm-repo instance found, stop end. error: ${t}`)}}))}exports.stopCmd=function(){return t(this,void 0,void 0,(function*(){try{yield l(),(0,r.consoleInfo)('stop "ohpm-repo" successfully.'),c.default.shutdown((()=>process.exit(0)))}catch(t){(0,r.consoleError)(`server fail to stop: ${t}.`),c.default.shutdown((()=>process.exit(1)))}}))},exports.stopExecute=l;