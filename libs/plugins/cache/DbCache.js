"use strict";var e=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,c){function o(e){try{d(n.next(e))}catch(e){c(e)}}function a(e){try{d(n.throw(e))}catch(e){c(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.dbCache=void 0;const t=require("../../service/cache/CacheService"),i=require("../../service/cache/CacheRepository");exports.dbCache=new class{exists(t){return e(this,void 0,void 0,(function*(){return!!(yield this.determineExpiration(t))}))}set(i,n,r){return e(this,void 0,void 0,(function*(){yield t.cacheService.addCache(i,n,r)}))}get(t){return e(this,void 0,void 0,(function*(){const e=yield this.determineExpiration(t);return e&&e.value?e.isObject?JSON.parse(e.value):e.value:null}))}delete(i){return e(this,void 0,void 0,(function*(){yield t.cacheService.deleteByKey(i)}))}clear(){return e(this,void 0,void 0,(function*(){yield t.cacheService.deleteExpiredCache()}))}determineExpiration(n){return e(this,void 0,void 0,(function*(){const e=yield t.cacheService.findCacheDataByKey(n);if(e){if(e.options){const t=JSON.parse(e.options);if(t.ttl&&Date.now()-e.createTime>1e3*t.ttl)return yield i.cacheRepository.deleteByKey(e.id),null}return e}return null}))}};