"use strict";var e=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(c,n){function r(e){try{s(o.next(e))}catch(e){n(e)}}function a(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?c(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}s((o=o.apply(e,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.cacheService=void 0;const t=require("../../entity/CacheData"),i=require("../../utils/PageUtil"),o=require("./CacheRepository");exports.cacheService=new class{addCache(i,c,n,r){return e(this,void 0,void 0,(function*(){if(yield o.cacheRepository.findCacheDataByKey(i))yield o.cacheRepository.updateState(i,c,n,r);else{const e="object"==typeof c,r=new t.CacheData({id:i,value:e?JSON.stringify(c):c,options:JSON.stringify(n),isObject:e});yield o.cacheRepository.insert(r)}}))}findCacheDataByKey(t){return e(this,void 0,void 0,(function*(){return o.cacheRepository.findCacheDataByKey(t)}))}deleteByKey(t){return e(this,void 0,void 0,(function*(){yield o.cacheRepository.deleteByKey(t)}))}deleteExpiredCache(){return e(this,void 0,void 0,(function*(){const{recordList:e}=yield o.cacheRepository.findByFilter(1,i.MAX_PAGE_SIZE);for(const t of e)if(t.options){const e=JSON.parse(t.options);e.ttl&&Date.now()-t.createTime>1e3*e.ttl&&(yield o.cacheRepository.deleteByKey(t.id))}}))}};