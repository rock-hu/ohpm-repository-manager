"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CustomFunctionRule=void 0;const e=require("./types"),r=require("../../../packages/log"),t=require("../customValidateFunc/CustomValidateError");exports.CustomFunctionRule=class{constructor(e,r){this.customValidateFuncArray=e,this.errorCallback=r}validate(s,a,o){o=o||a;const i=s.name;r.OhpmLazyLogger.debug(`start CustomFunctionRule.validate attribute "${o}" for package "${i}" in publishJson.`);for(let u=0;u<this.customValidateFuncArray.length;u++){const n=this.customValidateFuncArray[u];if(n)try{s[a]&&n(s[a])}catch(r){r instanceof t.CustomValidateError?(this.errorMsg=r.message,this.errorMsgCN=r.messageCN):(this.errorMsg=r.message,this.errorMsgCN=r.message),this.errorCallback(o,{attrName:o,ruleType:e.ValidationRuleType.CustomFunction,err:null,errorMsg:this.getErrorMsg(o,i),extInfo:{messageCN:this.getErrorMsgCN(o,i)}},i)}else r.OhpmLazyLogger.warn(`attribute "${o}" for package "${i}" in "oh-package.json5" undefined validate method.`)}r.OhpmLazyLogger.debug(`CustomFunctionRule.validate attribute "${o}" for package "${i}" in publishJson successfully.`)}getErrorMsg(e,r){return`attribute "${e}" for package "${r}" in "oh-package.json5" validate fail, ${this.errorMsg}.`}getErrorMsgCN(e,r){return`在包 "${r}" 的oh-package.json5文件中，字段 "${e}" 未通过规则校验，${this.errorMsgCN}`}};