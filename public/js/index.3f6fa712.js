import{h as K,B as Y,_ as P,j as G,ai as c,aq as x,o as y,c as A,Q as ee,O as J,P as i,V as t,T as D,U as h,a as k,J as M,u as $,S as Q,t as H,e as O,f as W,$ as X,I as oe,a9 as q,n as te,i as ae}from"./@vue.405cd0f3.js";import{E as ne,a as ie,d as re,g as le}from"./organization.f666534f.js";import{a as se}from"./vue-router.779da2c0.js";import{_ as F,d as de,A as E}from"./index.83aebd5f.js";import{B as ge}from"./Button.59bb2c30.js";import{P as ue}from"./centerPagination.65484f4d.js";import{a as R}from"./element-plus.d9770c7f.js";import{C as me}from"./ConfirmDialog.f3308ea3.js";import"./axios.a3888612.js";import"./vue-i18n.b3f06251.js";import"./@intlify.54dd1442.js";import"./vue.44d375da.js";import"./marked.710fa320.js";import"./xss.e4f2f0a8.js";import"./clipboard.ce371577.js";import"./cssfilter.393cb597.js";import"./dayjs.f9ab3a77.js";import"./node-forge.4054bff5.js";import"./@element-plus.1b716427.js";import"./vuex.10212040.js";import"./highlight.js.504c3f6b.js";/* empty css                            */import"./lodash-es.2c2c875c.js";import"./@vueuse.1b628eaa.js";import"./@popperjs.c75af06c.js";import"./@ctrl.86a38320.js";import"./async-validator.bf8f818c.js";import"./memoize-one.297ddbcb.js";import"./normalize-wheel-es.54f5de6c.js";import"./@floating-ui.57eef0fc.js";import"./FooterButtons.71958792.js";const pe={class:"orginzation-table"},ce=["onClick"],fe=["onClick"],ze=["onClick"],he=["onClick"],_e={__name:"OrganizationListItem",props:{organization:Array,itemRenderKeys:Array,organizationLoading:Boolean},emits:["emitDialog","deleteDialog"],setup(e,{emit:a}){const f=e,m=a,r=K().appContext.config.globalProperties,n=Y("loginUser").loginUser,l=P({headStyle:{background:"#F5F5F5",color:"#000000"},headRowStyle:{height:"40px"},router:se()}),p=G(()=>r.$t("tree.noData")),_=o=>{l.router.push({name:"organizationSetting",query:{orgId:o.id,tab:"description"}})},w=o=>de(o,"YYYY-MM-DD hh:mm:ss"),d=o=>{z(n.name,o.owner)&&m("emitDialog",o)},g=o=>{z(n.name,o.owner)&&!o.packageNum&&m("deleteDialog",o)},z=(o,S)=>S.includes(o),v=o=>{n.role&&l.router.push({name:"organizationAdminSetting",query:{orgId:o.id}})};return(o,S)=>{const b=c("el-table-column"),I=c("el-table"),T=x("loading");return y(),A("div",pe,[ee((y(),J(I,{data:f.organization,"empty-text":p.value,"header-cell-style":l.headStyle,"header-row-style":l.headRowStyle,style:{width:"100%"}},{default:i(()=>[t(b,{label:o.$t("organization.name"),"min-width":"80",prop:"name","show-overflow-tooltip":""},null,8,["label"]),t(b,{label:o.$t("organization.description"),"min-width":"80",prop:"description","show-overflow-tooltip":""},null,8,["label"]),t(b,{label:o.$t("organization.owner"),"min-width":"80",prop:"owners","show-overflow-tooltip":""},{default:i(s=>[D(h(s.row.owner.join(",")),1)]),_:1},8,["label"]),t(b,{label:o.$t("organization.created"),"min-width":"80",prop:"created","show-overflow-tooltip":"",width:"160"},{default:i(s=>[D(h(w(s.row.createTime)),1)]),_:1},8,["label"]),t(b,{label:o.$t("organization.membersCount"),prop:"memberNum","show-overflow-tooltip":"",width:"110"},null,8,["label"]),t(b,{label:o.$t("organization.bundlesCount"),prop:"packageNum","show-overflow-tooltip":"",width:"110"},null,8,["label"]),t(b,{label:o.$t("organization.operate"),"min-width":"120","show-overflow-tooltip":"",width:"260"},{default:i(s=>[k("span",{class:M(["pointer","operate"]),onClick:u=>_(s.row)},h(o.$t("default.details")),9,ce),k("span",{class:M(["pointer","operate","operate-left",z($(n).name,s.row.owner)?null:"curStyle"]),onClick:u=>d(s.row)},h(o.$t("organization.editOrganize")),11,fe),$(n).role?(y(),A("span",{key:0,class:M(["pointer","operate","operate-left"]),onClick:u=>v(s.row)},h(o.$t("organization.editGroupAdmin")),9,ze)):Q("",!0),k("span",{class:M(["pointer","operate","operate-left",z($(n).name,s.row.owner)&&!s.row.packageNum?null:"curStyle"]),onClick:u=>g(s.row)},h(o.$t("notification.delete")),11,he)]),_:1},8,["label"])]),_:1},8,["data","empty-text","header-cell-style","header-row-style"])),[[T,f.organizationLoading]])])}}},we=F(_e,[["__scopeId","data-v-2112134f"]]);const be=H({name:"AddOrganizationDialog",props:{visible:Boolean,editRadio:{type:Boolean,default:!1},editList:{type:Object,default:{}}},setup(e,a){const f=K().appContext.config.globalProperties,m=O(null),r=P({orgModel:{name:"",description:""},owner:"",packageNum:0}),n=G(()=>e.visible),l=e.editRadio?{name:[{required:!0,validator:E,trigger:"blur"}],description:[{required:!0,message:f.$t("validator.desIsNotNull"),trigger:"blur"}]}:{name:[{required:!0,message:f.$t("validator.nameIsNotNull"),trigger:"blur"},{required:!0,validator:E,trigger:"blur"}],description:[{required:!0,message:f.$t("validator.desIsNotNull"),trigger:"blur"}]};W(()=>e.editRadio,d=>{if(d){const{name:g,description:z,owner:v,packageNum:o}=e.editList;r.orgModel={name:g,description:z},r.owner=v,r.packageNum=o}},{immediate:!0});const p=()=>{r.orgModel.name="",r.orgModel.description="",r.owner=""},_=()=>{p(),a.emit("onClose")},w=d=>{d.validate(g=>{if(g){const z=e.editRadio?ne:ie,v={group_name:r.orgModel.name,group_description:r.orgModel.description},o=e.editRadio?{...v,id:e.editList.id}:v;z(o).then(S=>{S.code===200&&(e.editRadio?R.success(i18n("login.editSuccess")):R.success(i18n("organization.addSuccess")))}).finally(()=>{a.emit("DialogAddOrUpdate"),_()})}})};return{...X(r),rules:l,handleClose:_,saveOrganization:w,dialogVisible:n,formRef:m}}}),ve={class:"organization-add-dialog"},Ce={class:"font-M dialog-title"};function $e(e,a,f,m,r,n){const l=c("el-input"),p=c("el-form-item"),_=c("el-button"),w=c("el-form"),d=c("el-dialog");return y(),A("div",ve,[t(d,{modelValue:e.dialogVisible,"onUpdate:modelValue":a[4]||(a[4]=g=>e.dialogVisible=g),"before-close":e.handleClose,"close-on-click-modal":!1,"destroy-on-close":"",width:"640px"},{header:i(()=>[k("div",Ce,[oe(e.$slots,"default",{},void 0,!0)])]),default:i(()=>[t(w,{ref:"formRef",model:e.orgModel,rules:e.rules,"label-position":"top"},{default:i(()=>[t(p,{prop:"name"},{label:i(()=>[k("span",null,h(e.$t("organization.name")),1)]),default:i(()=>[t(l,{modelValue:e.orgModel.name,"onUpdate:modelValue":a[0]||(a[0]=g=>e.orgModel.name=g),disabled:e.editRadio&&e.packageNum>0,placeholder:e.$t("organization.nameTip")},null,8,["modelValue","disabled","placeholder"])]),_:1}),t(p,{label:e.$t("organization.description"),class:"formItem",prop:"description"},{default:i(()=>[t(l,{modelValue:e.orgModel.description,"onUpdate:modelValue":a[1]||(a[1]=g=>e.orgModel.description=g),placeholder:e.$t("organization.descriptionPlaceholder"),class:"form-input-textarea",maxlength:"1024",rows:"5","show-word-limit":"",type:"textarea"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(p,null,{default:i(()=>[t(_,{class:"btnCancal",onClick:a[2]||(a[2]=g=>e.handleClose(e.formRef))},{default:i(()=>[D(h(e.$t("button.cancel")),1)]),_:1}),t(_,{class:"btnColor",onClick:a[3]||(a[3]=g=>e.saveOrganization(e.formRef))},{default:i(()=>[D(h(e.$t("button.confirm")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:3},8,["modelValue","before-close"])])}const j=F(be,[["render",$e],["__scopeId","data-v-91024e89"]]);const Oe={class:"organization"},ye={class:"title-line"},Se={__name:"index",props:{organizationList:Array,totalSize:[Number,String],currentPage:[Number,String],pageSize:[Number,String],handleOrganizationChange:Function,organizationLoading:Boolean},emits:["fetchOrganizations","afterAddOrUpdate","updateFilter"],setup(e,{emit:a}){const f=Y("loginUser").loginUser,m=a,r=O(!1),n=O(!1),l=O(!1),p=O(!1),_=O({}),w=O(!1),d=P({organization:"",owner:""});W(d,()=>{m("updateFilter",{organization:d.organization,owner:d.owner})});const g=()=>{l.value=!1,r.value=!0},z=()=>{m("afterAddOrUpdate")},v=()=>{r.value=!1},o=u=>{const{id:C,name:L,owner:N,description:U,packageNum:V}=u;n.value=!0,l.value=!0,_.value={id:C,name:L,owner:N,description:U,packageNum:V}},S=()=>{n.value=!1,l.value=!1},b=()=>{p.value=!1,w.value={}},I=u=>{const{id:C,name:L}=u;w.value={id:C,name:L},p.value=!0},T=async()=>{try{(await re({id:w.value.id})).code===200&&R.success($t("notification.deleteSuccess"))}finally{m("afterAddOrUpdate"),b()}};async function s(){await te(),m("fetchOrganizations")}return(u,C)=>{const L=c("Search"),N=c("el-icon"),U=c("el-input"),V=c("el-form-item"),Z=c("el-form");return y(),A("div",Oe,[k("div",ye,[$(f).role===1?(y(),J(ge,{key:0,isPrimary:!0,text:u.$t("button.add"),class:"add-organization-btn",onClick:g},null,8,["text"])):Q("",!0),t(Z,{ref:"filterFormRef",inline:!0,model:d,class:"filter"},{default:i(()=>[t(V,{prop:"organization"},{default:i(()=>[t(U,{modelValue:d.organization,"onUpdate:modelValue":C[0]||(C[0]=B=>d.organization=B),maxlength:"30",clearable:"",placeholder:u.$t("organization.nameTip"),onKeyup:q(s,["enter","native"]),onClear:s},{prefix:i(()=>[t(N,{class:"prefix-icon",onClick:s},{default:i(()=>[t(L)]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1}),t(V,{prop:"owner"},{default:i(()=>[t(U,{modelValue:d.owner,"onUpdate:modelValue":C[1]||(C[1]=B=>d.owner=B),maxlength:"30",clearable:"",placeholder:u.$t("organization.ownerInputTip"),onKeyup:q(s,["enter","native"]),onClear:s},{prefix:i(()=>[t(N,{class:"prefix-icon",onClick:s},{default:i(()=>[t(L)]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1})]),_:1},8,["model"])]),t($(we),{organization:e.organizationList,organizationLoading:e.organizationLoading,onDeleteDialog:I,onEmitDialog:o},null,8,["organization","organizationLoading"]),t(ue,{"current-page":e.currentPage,handleCurrentChange:e.handleOrganizationChange,"page-size":e.pageSize,total:e.totalSize},null,8,["current-page","handleCurrentChange","page-size","total"]),t($(j),{visible:r.value,onDialogAddOrUpdate:z,onOnClose:v},{default:i(()=>[D(h(u.$t("organization.addTitle")),1)]),_:1},8,["visible"]),t($(j),{editList:_.value,editRadio:l.value,visible:n.value,onDialogAddOrUpdate:z,onOnClose:S},{default:i(()=>[D(h(u.$t("organization.editOrganize")),1)]),_:1},8,["editList","editRadio","visible"]),t($(me),{buttonStyle:!0,title:u.$t("notification.confirmTitle",{name:w.value.name}),visible:p.value,onOnClose:b,onOnConfirm:T},null,8,["title","visible"])])}}},Le=F(Se,[["__scopeId","data-v-050b814b"]]),ke=H({components:{OrganizationContent:Le},setup(){const e=P({pageSize:10,organizationCurrentPage:1,organizationTotalSize:0,organizationList:[],organizationLoading:!1,organizationName:"",owner:""}),a=()=>{e.organizationLoading=!0,le({currentPage:e.organizationCurrentPage,pageSize:e.pageSize,groupName:e.organizationName,groupAdminName:e.owner}).then(n=>{if(n.code===200){const{data:l,total:p}=n.data;e.organizationList=l,e.organizationLoading=!1,e.organizationTotalSize=p}else R.error(n.message)}).finally(()=>e.organizationLoading=!1)},f=n=>{e.organizationCurrentPage=n,a()},m=()=>{e.organizationCurrentPage=1,a()};function r(n){e.organizationName=n.organization,e.owner=n.owner}return ae(()=>{a()}),{...X(e),afterAddOrUpdateOrganization:m,handleOrganizationChange:f,fetchOrganizations:a,updateFilter:r}}}),De={class:"organization1"};function Ae(e,a,f,m,r,n){const l=c("OrganizationContent");return y(),A("div",De,[t(l,{ref:"organization",organizationList:e.organizationList,handleOrganizationChange:e.handleOrganizationChange,pageSize:e.pageSize,totalSize:e.organizationTotalSize,currentPage:e.organizationCurrentPage,organizationLoading:e.organizationLoading,onFetchOrganizations:e.fetchOrganizations,onAfterAddOrUpdate:e.afterAddOrUpdateOrganization,onUpdateFilter:e.updateFilter},null,8,["organizationList","handleOrganizationChange","pageSize","totalSize","currentPage","organizationLoading","onFetchOrganizations","onAfterAddOrUpdate","onUpdateFilter"])])}const so=F(ke,[["render",Ae]]);export{so as default};
