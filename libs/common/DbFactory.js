"use strict";var e=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{c(n.next(e))}catch(e){r(e)}}function s(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.initDB=exports.commonDB=void 0;const t=require("../plugins/db/FileDB"),i=require("../packages/log"),n=require("../plugins/db/sqlDb/DbHelper"),o=require("./DbAndStoreType");exports.initDB=function(r){return e(this,void 0,void 0,(function*(){if(exports.commonDB)i.OhpmLazyLogger.warn("already loaded db plugin.");else if(r.type!==o.DbType.FileDb)if(r.type!==o.DbType.Mysql)try{const e=require(r.type);exports.commonDB=e.init(r.config)}catch(e){const t=`load db plugin ${r.type} failed,`;throw i.OhpmLazyLogger.error(t,e.message),new Error(t)}else try{exports.commonDB=yield n.DbHelper.getInstance(r.config),i.OhpmLazyLogger.info('initialize "MySQL database" successfully.')}catch(e){throw new Error(`fail to initialize the MySQL database, please check the MySQL configuration: "${e.message}"`)}else try{exports.commonDB=yield t.FileDB.getInstance(r.config),i.OhpmLazyLogger.info('initialize "file database" successfully.')}catch(e){throw new Error(`fail to initialize the file database, please check the fileDb configuration: "${e.message}"`)}}))};