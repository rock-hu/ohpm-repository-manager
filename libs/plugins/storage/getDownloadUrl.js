"use strict";var e=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function l(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}a((i=i.apply(e,t||[])).next())}))},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getDownloadUrl=void 0;const n=require("../../packages/log"),i=t(require("path")),o=require("../../utils/CommonUtil");exports.getDownloadUrl=function(t){return e(this,void 0,void 0,(function*(){if(!t)return n.OhpmLazyLogger.warn("storage: fileKey is not defined."),"";if(decodeURIComponent(t).includes(".."))return n.OhpmLazyLogger.warn('storage: fileKey includes ".."!'),"";let e;const r=t.split("/");if(t.includes("@"))if(4===r.length){const t=r[0],n=r[1],o=r[2],s=r[3];e=i.default.posix.join(t,n,o,"-",n,s)}else{if(5!==r.length)return n.OhpmLazyLogger.warn("storage: fileKey is invalid, fileKey:",t),"";{const t=r[0],n=r[1],o=r[2],s=r[3],l=r[4];e=i.default.posix.join(t,n,o,"-",n,s,l)}}else if(3===r.length){const t=r[0],n=r[1],o=r[2];e=i.default.posix.join(t,n,"-",o)}else{if(4!==r.length)return n.OhpmLazyLogger.warn("storage: fileKey is invalid, fileKey:",t),"";{const t=r[0],n=r[1],o=r[2],s=r[3];e=i.default.posix.join(t,n,"-",o,s)}}const s=`${o.CommonUtil.getServerAddress()}/${e}`;return n.OhpmLazyLogger.info("storage: obtaining the download address succeeded. url: ",t),s}))};