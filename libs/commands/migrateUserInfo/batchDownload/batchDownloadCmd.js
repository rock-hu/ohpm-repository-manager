"use strict";var e=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.AdminRole=exports.PACKAGE_MANIFEST_TABLE=exports.USER_TABLE=exports.PkgInfoJson=void 0;const o=require("../../../packages/log"),n=t(require("log4js")),r=t(require("path")),i=require("../../../utils/FsUtil"),s=require("../common/checkInstallAndSetRoot"),a=require("../../../common/Constants"),c=require("./batchDownloadCore/batchDownloadRegistryExecute"),l=require("./batchDownloadCore/batchDownloadExecute");exports.PkgInfoJson="pkgInfo.json",exports.USER_TABLE="user",exports.PACKAGE_MANIFEST_TABLE="package_manifest",exports.AdminRole=1,exports.default=function(t,u){return e(this,void 0,void 0,(function*(){yield(0,s.checkInstallAndSetRoot)();const{publicRegistry:e}=u,d=`batch_download_${Date.now()}`,f=r.default.join(a.Constants.DATA_DIR,"temp","batch_download"),h=r.default.join(f,d);yield i.FsUtil.createDirIfNotExists(h);const p=`${d}.zip`;try{e?yield(0,c.batchDownloadRegistryExecute)(t,h,p,u):yield(0,l.batchDownloadExecute)(t,h,p)}catch(e){(0,o.consoleError)(`batch download fail: ${e.message}`)}finally{(yield i.FsUtil.exists(h))&&(yield i.FsUtil.rm(h,{recursive:!0,force:!0})),n.default.shutdown((()=>process.exit(1)))}}))};