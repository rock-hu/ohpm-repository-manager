"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LengthLimitRule=void 0;const e=require("./types"),t=require("../../../common/RepoError"),r=require("../../../common"),n=require("../../../packages/log");exports.LengthLimitRule=class{constructor(e,t,r){this.maxLength=e,this.minLength=t,this.errorCallback=r}validate(t,r,i){i=i||r;const h=t.name;n.OhpmLazyLogger.debug(`start LengthLimitRule.validate attribute "${i}" for package "${h}" in publishJson.`),!t[r]&&this.minLength>0&&this.errorCallback(i,{attrName:i,ruleType:e.ValidationRuleType.LengthLimit,err:null,errorMsg:this.getErrorMsg(i,h),extInfo:{messageCN:this.getErrorMsgCN(i,h)}},h);const a=t[r];a?((this.maxLength>0&&a.length>this.maxLength||this.minLength>=0&&a.length<this.minLength)&&this.errorCallback(i,{attrName:i,ruleType:e.ValidationRuleType.LengthLimit,err:null,errorMsg:this.getErrorMsg(i,h),extInfo:{messageCN:this.getErrorMsgCN(i,h)}},h),n.OhpmLazyLogger.debug(`LengthLimitRule.validate attribute "${i}" for package "${h}" in publishJson succeed.`)):n.OhpmLazyLogger.debug(`attribute "${i}" for package "${h}" is empty in publishJson.`)}getErrorMsg(e,i){if(this.maxLength>0&&this.minLength>=0)return`the length of attribute "${e}" for package "${i}" in "oh-package.json5" must range [${this.minLength}, ${this.maxLength}].`;if(this.maxLength>0)return`the length of attribute "${e}" for package "${i}" in "oh-package.json5" must range [0, ${this.maxLength}].`;if(this.minLength>=0)return`the length of attribute "${e}" for package "${i}" in "oh-package.json5" must range [${this.minLength}, Infinity).`;throw n.OhpmLazyLogger.error(`both "maxLen": ${this.maxLength} and \n      "minLen": ${this.minLength} for package "${i}" in the LengthLimitRule are less than 0.`),new t.RepoClientError(r.ErrorCode.UnexpectedError,"Unknown Error.")}getErrorMsgCN(e,i){if(this.maxLength>0&&this.minLength>=0)return`在包 "${i}" 的oh-package.json5文件中，字段 "${e}" 值的长度必须大于等于 ${this.minLength}，小于等于 ${this.maxLength}`;if(this.maxLength>0)return`在包 "${i}" 的oh-package.json5文件中，字段 "${e}" 值的长度必须小于等于 ${this.maxLength}`;if(this.minLength>=0)return`在包 "${i}" 的oh-package.json5文件中，字段 "${e}" 值的长度必须大于等于 ${this.minLength}`;throw n.OhpmLazyLogger.error(`在包 "${i}" 的oh-package.json5文件中，字段 "${e}" 的最大值"${this.maxLength}" 必须大于0且最小值 "${this.minLength}" 必须大于等于0.`),new t.RepoClientError(r.ErrorCode.UnexpectedError,"Unknown Error")}};