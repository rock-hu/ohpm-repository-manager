"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var o={};if(null!=r)for(var n in r)"default"!==n&&Object.prototype.hasOwnProperty.call(r,n)&&e(o,r,n);return t(o,r),o},o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(n,i){function a(e){try{s(o.next(e))}catch(e){i(e)}}function u(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,u)}s((o=o.apply(e,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.uplinkStorageController=void 0;const n=r(require("express")),i=require("./UplinkStorageService"),a=require("../../../packages/log"),u=require("../../../common/RepoResponse");exports.uplinkStorageController=new class{constructor(){this.basePath="/api/uplink-storage",this.router=n.Router(),this.initRouter()}initRouter(){this.router.get("/:uplinkName/:group/:pkgName/-/:version",this.download),this.router.get("/:uplinkName/:pkgName/-/:version",this.download)}download(e,t){return o(this,void 0,void 0,(function*(){try{const r={uplinkName:e.params.uplinkName,group:e.params.group,pkgName:e.params.pkgName,version:e.params.version},o=yield i.uplinkStorageService.download(r);if(!o)return void u.RepoResponse.notFound(t);t.download(o)}catch(e){a.OhpmLazyLogger.error("uplink storage download error:",e.message),u.RepoResponse.notFound(t)}}))}};