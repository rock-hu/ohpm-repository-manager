"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ListItemLengthLimitRule=void 0;const e=require("./types"),t=require("../../../packages/log"),r=require("../../../common/RepoError"),n=require("../../../common");exports.ListItemLengthLimitRule=class{constructor(e,t,r){this.maxLength=e,this.minLength=t,this.errorCallback=r}validate(r,n,i){i=i||n;const h=r.name;t.OhpmLazyLogger.debug(`start ItemLengthLimitRule.validate attribute "${i}" for package "${h}" in publishJson.`);const a=r[n];a&&(Array.isArray(a)?(a.forEach((t=>{(this.maxLength>0&&t.length>this.maxLength||this.minLength>=0&&(!t||t.length<this.minLength))&&this.errorCallback(i,{attrName:i,ruleType:e.ValidationRuleType.ListItemLengthLimit,err:null,errorMsg:this.getErrorMsg(i,h),extInfo:{messageCN:this.getErrorMsgCN(i,h)}},h)})),t.OhpmLazyLogger.debug(`ItemLengthLimitRule.validate attribute "${i}" for package "${h}" in publishJson succeed.`)):this.errorCallback(i,{attrName:i,ruleType:e.ValidationRuleType.ListItemLengthLimit,err:null,errorMsg:`attribute "${i}" for package "${h}" is not an array.`,extInfo:{messageCN:`包"${h}"的oh-package.json5文件中属性 "${i}" 必须为数组类型`}},h))}getErrorMsg(e,i){if(this.maxLength>0&&this.minLength>=0)return`the length of each item of the attribute "${e}" for package "${i}" in "oh-package.json5" must range [${this.minLength}, ${this.maxLength}].`;if(this.maxLength>0)return`the length of each item of the attribute "${e}" for package "${i}" in "oh-package.json5" must range [0, ${this.maxLength}].`;if(this.minLength>=0)return`the length of each item of the attribute "${e}" for package "${i}" in "oh-package.json5" must range [${this.minLength}, Infinity).`;throw t.OhpmLazyLogger.error(`both "maxLen": ${this.maxLength} and \n      "minLen": ${this.minLength} for package "${i}" in the ItemLengthLimitRule are less than 0.`),new r.RepoClientError(n.ErrorCode.UnexpectedError,"Unknown Error")}getErrorMsgCN(e,i){if(this.maxLength>0&&this.minLength>=0)return`在包 "${i}" 的oh-package.json5文件中，字段 "${e}" 各元素的长度必须大于等于 ${this.minLength}，小于等于 ${this.maxLength}`;if(this.maxLength>0)return`在包 "${i}" 的oh-package.json5文件中，字段 "${e}" 各元素的长度必须小于等于 ${this.maxLength}`;if(this.minLength>=0)return`在包 "${i}" 的oh-package.json5文件中，字段 "${e}" 各元素的长度必须大于等于 ${this.minLength}`;throw t.OhpmLazyLogger.error(`在包 "${i}" 的oh-package.json5文件中，字段 "${e}" 的最大值 "${this.maxLength}" 必须大于0且最小值 "${this.minLength}" 必须大于等于0。`),new r.RepoClientError(n.ErrorCode.UnexpectedError,"Unknown Error")}};