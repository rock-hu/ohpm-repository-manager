"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,o)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(i){if(i&&i.__esModule)return i;var r={};if(null!=i)for(var o in i)"default"!==o&&Object.prototype.hasOwnProperty.call(i,o)&&e(r,i,o);return t(r,i),r},r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(o,c){function u(e){try{s(r.next(e))}catch(e){c(e)}}function n(e){try{s(r.throw(e))}catch(e){c(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(u,n)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.publicKeyController=void 0;const o=i(require("express")),c=require("../../common"),u=require("./PublicKeyService"),n=require("../../packages/log"),s=require("../adminAuditLog/AdminAuditLogService"),d=require("../../common/OperateType"),a=require("../../common/RepoResponse");exports.publicKeyController=new class{constructor(){this.basePath="/api/public-keys",this.router=o.Router(),this.initRouter()}initRouter(){this.router.get("",c.SessionUtil.check,c.CsrfToken.validate,this.getPublicKeyList),this.router.post("",c.SessionUtil.check,c.CsrfToken.validate,this.addPublicKey),this.router.delete("/:id",c.SessionUtil.check,c.CsrfToken.validate,this.delPublicKeyById)}addPublicKey(e,t,i){return r(this,void 0,void 0,(function*(){const r=e.body,o=e.ctx.userId;try{yield u.publicKeyService.addPublicKey(o,r);const i=n.OhpmLazyLogger.operateSuccess(e,"addPublicKey");a.RepoResponse.ok(t),yield s.adminAuditLogService.addSuccessLog(o,d.OperateType.addPublicKey,i)}catch(t){n.OhpmLazyLogger.operateFailure(e,"addPublicKey"),yield s.adminAuditLogService.addFailureLog(o,d.OperateType.addPublicKey,t.message),i(t)}}))}getPublicKeyList(e,t,i){return r(this,void 0,void 0,(function*(){const r=e.ctx.userId;try{const e=yield u.publicKeyService.getPublicKeyList(r);a.RepoResponse.success(t,e)}catch(e){i(e)}}))}delPublicKeyById(e,t,i){return r(this,void 0,void 0,(function*(){const r=e.params.id,o=e.ctx.userId;try{yield u.publicKeyService.delPublicKeyById(r,o);const i=n.OhpmLazyLogger.operateSuccess(e,"delPublicKeyById");a.RepoResponse.ok(t),yield s.adminAuditLogService.addSuccessLog(o,d.OperateType.delPublicKey,i)}catch(t){n.OhpmLazyLogger.operateFailure(e,"delPublicKeyById"),yield s.adminAuditLogService.addFailureLog(o,d.OperateType.delPublicKey,t.message),i(t)}}))}};