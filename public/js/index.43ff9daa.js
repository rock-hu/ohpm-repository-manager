import{C as Y}from"./ConfirmDialog.f3308ea3.js";import{b as q,c as J,e as j,f as E,h as G}from"./organization.f666534f.js";import{_ as y,d as k,B as Q,C as W}from"./index.83aebd5f.js";import{a as B}from"./vue-router.779da2c0.js";import{a as L}from"./element-plus.d9770c7f.js";import{t as P,h as A,B as V,_ as D,j as $,$ as M,ai as c,aq as T,o as h,c as w,Q as O,O as S,P as b,V as n,U as v,T as U,a as _,J as H,e as K,bm as X,bk as Z,S as z,i as x,f as I,u as N}from"./@vue.405cd0f3.js";import{P as R}from"./centerPagination.65484f4d.js";import{B as ee}from"./Button.59bb2c30.js";import{u as te}from"./vuex.10212040.js";import"./FooterButtons.71958792.js";import"./axios.a3888612.js";import"./vue-i18n.b3f06251.js";import"./@intlify.54dd1442.js";import"./vue.44d375da.js";import"./marked.710fa320.js";import"./xss.e4f2f0a8.js";import"./clipboard.ce371577.js";import"./cssfilter.393cb597.js";import"./dayjs.f9ab3a77.js";import"./node-forge.4054bff5.js";import"./@element-plus.1b716427.js";import"./highlight.js.504c3f6b.js";/* empty css                            */import"./lodash-es.2c2c875c.js";import"./@vueuse.1b628eaa.js";import"./@popperjs.c75af06c.js";import"./@ctrl.86a38320.js";import"./async-validator.bf8f818c.js";import"./memoize-one.297ddbcb.js";import"./normalize-wheel-es.54f5de6c.js";import"./@floating-ui.57eef0fc.js";const oe=P({props:{usersList:Array,memberLoading:Boolean,owner:Array},components:{ConfirmDialog:Y},setup(e,a){const d=B(),l=A().appContext.config.globalProperties,t=V("loginUser").loginUser,u=D({headStyle:{background:"#F5F5F5",color:"#000000"},headRowStyle:{height:"40px"},dialogVisible:!1,memberList:{}}),r=$(()=>l.$t("tree.noData")),m=({columnIndex:s})=>s===2?"cell-pl-0":"",i=()=>{u.dialogVisible=!1},p=s=>{if(e.owner.includes(s.userName)&&e.owner.length===1){L.warning(l.$t("organization.cannotDelLastGroupAdmin"));return}if(!e.owner.includes(t.name)){L.warning(l.$t("organization.notGroupAdmin"));return}u.memberList=s,u.dialogVisible=!0},g=()=>{i(),f()},o=s=>k(s,"YYYY-MM-DD hh:mm:ss"),f=()=>{const{id:s}=JSON.parse(sessionStorage.getItem("organizeDetail"));q({id:s,mId:u.memberList.id}).then(C=>{C.code===200&&(t.name===u.memberList.userName&&t.role!==1?d.push({name:"organizations"}):a.emit("afterAddUser",u.memberList.userName),L.success(i18n("notification.deleteSuccess")))}).catch(()=>{a.emit("afterAddUser",u.memberList.userName)})};return{...M(u),noData:r,cellStyle:m,handleDel:p,handleClose:i,confirmDelete:g,timeFormat:o,loginUser:t}}}),ae={class:"member-list-item"},ne={key:0},re={key:1},se=["onClick"];function le(e,a,d,l,t,u){const r=c("el-table-column"),m=c("el-table"),i=c("ConfirmDialog"),p=T("loading");return h(),w("div",ae,[O((h(),S(m,{"cell-class-name":e.cellStyle,data:e.usersList,"empty-text":e.noData,"header-cell-style":e.headStyle,"header-row-style":e.headRowStyle},{default:b(()=>[n(r,{label:e.$t("default.username"),prop:"userName","show-overflow-tooltip":""},null,8,["label"]),n(r,{label:e.$t("default.role"),prop:"role","show-overflow-tooltip":""},{default:b(g=>[g.row.role===1?(h(),w("span",ne,v(e.$t("organization.owner")),1)):(h(),w("span",re,v(e.$t("organization.members")),1))]),_:1},8,["label"]),n(r,{label:e.$t("default.addTime"),prop:"createTime","show-overflow-tooltip":""},{default:b(g=>[U(v(e.timeFormat(g.row.createTime)),1)]),_:1},8,["label"]),n(r,{label:e.$t("security.operate"),"show-overflow-tooltip":"",width:"200px"},{default:b(g=>[_("span",{class:H(["del",!e.owner.includes(e.loginUser.name)||e.owner.length===1&&e.owner[0]===g.row.userName?"delNot":null]),onClick:o=>e.handleDel(g.row)},v(e.$t("notification.delete")),11,se)]),_:1},8,["label"])]),_:1},8,["cell-class-name","data","empty-text","header-cell-style","header-row-style"])),[[p,e.memberLoading]]),n(i,{title:e.$t("notification.confirmTitle",{name:e.memberList.userName}),visible:e.dialogVisible,onOnClose:e.handleClose,onOnConfirm:e.confirmDelete},null,8,["title","visible","onOnClose","onOnConfirm"])])}const ie=y(oe,[["render",le],["__scopeId","data-v-4cf0663a"]]);const de=P({name:"AddMemberDialog",props:{visible:Boolean},setup(e,a){const d=K(null),l=D({user:{account:"",role:"member"}}),t=$(()=>({account:[{required:!0,message:i18n("login.inputUserName"),trigger:"blur"}]})),u=()=>{l.user.account="",l.user.role="member"},r=()=>{u(),a.emit("onClose")},m=$(()=>e.visible),i=p=>{p.validate(g=>{if(g){const{id:o}=JSON.parse(sessionStorage.getItem("organizeDetail"));J(o,{userName:l.user.account}).then(f=>{f.code===200&&L.success("添加成功")}).finally(()=>{a.emit("afterAddUser"),r()})}})};return{...M(l),handleClose:r,formRef:d,saveMember:i,rules:t,dialogVisible:m}}}),ue=e=>(X("data-v-e8492b5a"),e=e(),Z(),e),me={class:"member-add-dialog"},ce={class:"dialog-title"},ge=ue(()=>_("span",{class:"mr-min"},null,-1));function pe(e,a,d,l,t,u){const r=c("el-input"),m=c("el-form-item"),i=c("el-option"),p=c("el-select"),g=c("el-form"),o=c("el-button"),f=c("el-dialog");return h(),w("div",me,[n(f,{modelValue:e.dialogVisible,"onUpdate:modelValue":a[4]||(a[4]=s=>e.dialogVisible=s),"before-close":e.handleClose,"close-on-click-modal":!1,"destroy-on-close":"",width:"640px"},{header:b(()=>[_("div",ce,v(e.$t("organization.addMemberTitle")),1)]),default:b(()=>[n(g,{ref:"formRef",inline:!0,model:e.user,rules:e.rules,"label-position":"top"},{default:b(()=>[n(m,{prop:"account"},{label:b(()=>[_("span",null,v(e.$t("default.user")),1)]),default:b(()=>[n(r,{modelValue:e.user.account,"onUpdate:modelValue":a[0]||(a[0]=s=>e.user.account=s),placeholder:e.$t("login.inputUserName"),style:{width:"320px"},class:"account-input"},null,8,["modelValue","placeholder"])]),_:1}),n(m,null,{label:b(()=>[ge]),default:b(()=>[n(p,{modelValue:e.user.role,"onUpdate:modelValue":a[1]||(a[1]=s=>e.user.role=s),disabled:!0,class:"role-select",size:"large"},{default:b(()=>[n(i,{label:e.$t("organization.owner"),value:"owner"},null,8,["label"]),n(i,{label:e.$t("organization.members"),value:"member"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),n(m,null,{default:b(()=>[n(o,{class:"btnCancal",onClick:a[2]||(a[2]=s=>e.handleClose(e.formRef))},{default:b(()=>[U(v(e.$t("button.cancel")),1)]),_:1}),n(o,{class:"btnColor",onClick:a[3]||(a[3]=s=>e.saveMember(e.formRef))},{default:b(()=>[U(v(e.$t("button.submit")),1)]),_:1})]),_:1})]),_:1},8,["modelValue","before-close"])])}const be=y(de,[["render",pe],["__scopeId","data-v-e8492b5a"]]);const fe=P({props:{usersList:Array,totalSize:[Number,String],currentPage:[Number,String],pageSize:[Number,String],memberLoading:Boolean},components:{MemberListItem:ie,Pagination:R,Button:ee,MemberAddDialog:be},setup(e,a){const d=V("loginUser").loginUser,l=D({showMemberAddDialog:!1,owner:JSON.parse(sessionStorage.getItem("organizeDetail")).owner||[]}),t=i=>{a.emit("afterUsersChange",i)},u=i=>{a.emit("afterUsersChange"),i&&(l.owner=l.owner.filter(p=>p!==i),sessionStorage.setItem("organizeDetail",JSON.stringify({...JSON.parse(sessionStorage.getItem("organizeDetail")),owner:l.owner})))},r=()=>{l.showMemberAddDialog=!0},m=()=>{l.showMemberAddDialog=!1};return{...M(l),handleUserChange:t,openMemberAddDialog:r,closeMemberAddDialog:m,afterUsersChange:u,loginUser:d}}}),_e={class:"member-setting"};function he(e,a,d,l,t,u){const r=c("Button"),m=c("MemberListItem"),i=c("Pagination"),p=c("MemberAddDialog");return h(),w("div",_e,[e.owner.includes(e.loginUser.name)?(h(),S(r,{key:0,isPrimary:!0,text:e.$t("default.addMember"),class:"add-new-member-btn",onClick:a[0]||(a[0]=g=>e.openMemberAddDialog())},null,8,["text"])):z("",!0),_("div",null,[n(m,{memberLoading:e.memberLoading,owner:e.owner,usersList:e.usersList,onAfterAddUser:e.afterUsersChange},null,8,["memberLoading","owner","usersList","onAfterAddUser"])]),n(i,{"current-page":e.currentPage,handleCurrentChange:e.handleUserChange,"page-size":e.pageSize,total:e.totalSize},null,8,["current-page","handleCurrentChange","page-size","total"]),n(p,{visible:e.showMemberAddDialog,onAfterAddUser:e.afterUsersChange,onOnClose:a[1]||(a[1]=g=>e.closeMemberAddDialog())},null,8,["visible","onAfterAddUser"])])}const ve=y(fe,[["render",he],["__scopeId","data-v-c1d9309f"]]);const we=P({name:"BundlesContent",props:{bundleLoading:Boolean,totalSize:[Number,String],currentPage:[Number,String],pageSize:[Number,String],bundleList:{type:Array,default:()=>[]}},components:{Pagination:R},setup(e,a){const d=A().appContext.config.globalProperties,l=D({headStyle:{background:"#F5F5F5",color:"#000000"},headRowStyle:{height:"40px"},errorDefault:'this.src="'+Q+'"'}),t=o=>!o||o==="null"?W:o,u=o=>{a.emit("BundlePageChange",o)},r=$(()=>d.$t("tree.noData")),m=$(()=>e.bundleList),i=$(()=>e.bundleLoading),p=o=>{switch(o){case 0:return"上架";case-1:return"审核中";case-2:return"审核拒绝";default:return"下架"}},g=o=>k(o,"YYYY-MM-DD hh:mm:ss");return{...M(l),noData:r,formatUrl:t,handleBundleChange:u,bundleList:m,handleStatus:p,timeFormat:g,bundleLoading:i}}}),Le={class:"bundle"},$e={class:"bundle-table"};function Se(e,a,d,l,t,u){const r=c("el-table-column"),m=c("el-table"),i=c("Pagination"),p=T("loading");return h(),w("div",Le,[_("div",$e,[O((h(),S(m,{data:e.bundleList,"header-cell-style":e.headStyle,"header-row-style":e.headRowStyle,"empty-text":e.noData,style:{width:"100%"}},{default:b(()=>[n(r,{prop:"name","show-overflow-tooltip":"",label:e.$t("default.name")},null,8,["label"]),n(r,{prop:"version","show-overflow-tooltip":"",label:e.$t("default.version")},null,8,["label"]),n(r,{prop:"description","show-overflow-tooltip":"",label:e.$t("default.describe"),width:"500"},null,8,["label"]),n(r,{prop:"license","show-overflow-tooltip":"",label:e.$t("default.license")},null,8,["label"]),n(r,{prop:"author","show-overflow-tooltip":"",label:e.$t("default.author")},null,8,["label"]),n(r,{prop:"keywords","show-overflow-tooltip":"",label:e.$t("default.keyword")},null,8,["label"])]),_:1},8,["data","header-cell-style","header-row-style","empty-text"])),[[p,e.bundleLoading]])]),n(i,{handleCurrentChange:e.handleBundleChange,"current-page":e.currentPage,total:e.totalSize,"page-size":e.pageSize},null,8,["handleCurrentChange","current-page","total","page-size"])])}const ye=y(we,[["render",Se],["__scopeId","data-v-c32ba759"]]);const Ce={class:"description"},De={class:"div flex-div"},ze={class:"btn-black font-M"},Pe={class:"btn-light"},Me={class:"flex-div"},Ue={class:"btn-black font-M"},Ae={class:"btn-light"},Ie={__name:"descriptions",props:{orgDetailList:Object},setup(e){return(a,d)=>(h(),w("div",Ce,[_("div",De,[_("span",ze,v(a.$t("organization.organizeName"))+"：",1),_("span",Pe,v(e.orgDetailList.name),1)]),_("div",Me,[_("span",Ue,v(a.$t("organization.organizeDescribe"))+"：",1),_("span",Ae,v(e.orgDetailList.description),1)])]))}},Ne=y(Ie,[["__scopeId","data-v-de964c61"]]);const ke={class:"organization-setting"},Be={class:"tabs-wrapper"},Ve={class:"tabs-head"},Te={class:"tabs-content"},Oe={__name:"index",setup(e){const a=te(),d=B(),l=A().appContext.config.globalProperties,t=D({activeTab:"description",userPageSize:10,userTotalSize:0,userCurrentPage:1,usersList:[],memberLoading:!0,bundleList:[],orgDetailList:{id:"",name:"",description:""},bundlePageSize:10,bundleTotalSize:10,bundleCurrentPage:1,bundleLoading:!1});x(async()=>{await u()}),I(()=>d.currentRoute.value,async()=>{d.currentRoute.value.name==="organizationSetting"&&await u()}),I(()=>t.activeTab,o=>{o!=="bundle"&&(t.bundlesCurrentPage=1),o==="member"&&(t.userCurrentPage=1)});const u=async()=>{if(t.activeTab=d.currentRoute.value.query.tab||"description",!(t.orgDetailList.id===d.currentRoute.value.query.orgId&&t.orgDetailList.name)){if(t.orgDetailList.id=d.currentRoute.value.query.orgId,!d.currentRoute.value.query.orgId){L.error(l.$t("organization.orgIdWithout")),await d.push({name:"organizations"});return}try{await a.dispatch("updateOrganizationSettingOrgBread","");const o=await j(t.orgDetailList.id);t.orgDetailList.name=o.data.name,await a.dispatch("updateOrganizationSettingOrgBread",t.orgDetailList.name),t.orgDetailList.description=o.data.description;const f={id:t.orgDetailList.id,name:t.orgDetailList.name,description:t.orgDetailList.description,owner:o.data.owner};sessionStorage.setItem("organizeDetail",JSON.stringify(f)),m(),i()}catch(o){await d.push({name:"organizations"})}}},r=o=>{d.push({name:"organizationSetting",query:{orgId:t.orgDetailList.id,tab:o.paneName}})},m=(o="")=>{t.memberLoading=!0,E(t.orgDetailList.id,{currentPage:o||t.userCurrentPage,pageSize:t.userPageSize}).then(f=>{if(f.code===200){const{total:s,data:C}=f.data;t.usersList=C,t.userTotalSize=s}else L.error(f.message)}).finally(()=>t.memberLoading=!1)},i=()=>{t.bundleLoading=!0,G(t.orgDetailList.id,{currentPage:t.bundleCurrentPage,pageSize:t.bundlePageSize}).then(o=>{if(o.code===200){const{total:f,data:s}=o.data;t.bundleList=s,t.bundleTotalSize=f}else L.error(o.message)}).finally(()=>t.bundleLoading=!1)},p=(o=1)=>{t.userCurrentPage=o,m()},g=(o=1)=>{t.bundleCurrentPage=o,i()};return(o,f)=>{const s=c("el-tab-pane"),C=c("el-tabs");return h(),w("div",ke,[_("div",Be,[_("div",Ve,[n(C,{modelValue:t.activeTab,"onUpdate:modelValue":f[0]||(f[0]=F=>t.activeTab=F),class:"tabs-wrapper",onTabClick:r},{default:b(()=>[n(s,{label:o.$t("default.describe"),name:"description"},null,8,["label"]),n(s,{label:o.$t("default.package"),name:"bundle"},null,8,["label"]),n(s,{label:o.$t("organization.members"),name:"member"},null,8,["label"])]),_:1},8,["modelValue"])]),_("div",Te,[t.activeTab==="description"?(h(),S(Ne,{key:0,orgDetailList:t.orgDetailList},null,8,["orgDetailList"])):z("",!0),t.activeTab==="member"?(h(),S(N(ve),{key:1,currentPage:t.userCurrentPage,memberLoading:t.memberLoading,pageSize:t.userPageSize,totalSize:t.userTotalSize,usersList:t.usersList,onAfterUsersChange:p},null,8,["currentPage","memberLoading","pageSize","totalSize","usersList"])):z("",!0),t.activeTab==="bundle"?(h(),S(N(ye),{key:2,bundleList:t.bundleList,bundleLoading:t.bundleLoading,currentPage:t.bundleCurrentPage,pageSize:t.bundlePageSize,totalSize:t.bundleTotalSize,onBundlePageChange:g},null,8,["bundleList","bundleLoading","currentPage","pageSize","totalSize"])):z("",!0)])])])}}},ft=y(Oe,[["__scopeId","data-v-aba9846a"]]);export{ft as default};
